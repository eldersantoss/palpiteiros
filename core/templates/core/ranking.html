{% extends 'base.html' %}

{% block title %}ClassificaÃ§Ã£o | Palpiteiros{% endblock title %}

{% block content %}

<h3>ClassificaÃ§Ã£o</h3>

<div class="period-form-container">
  <p>Escolha o perÃ­odo que deseja ver a classificaÃ§Ã£o:</p>
  <form action="{% url 'core:ranking' pool.slug %}" method="GET" class="period-form" id="ranking-form">
    <div id="div_id_periodo" class="form-group">
      <label for="id_periodo">PerÃ­odo:</label>
      {{ period_form.periodo }}
    </div>
    <div id="div_id_ano" class="form-group" style="display: none;">
      <label for="id_ano">Ano:</label>
      {{ period_form.ano }}
    </div>
    <div id="div_id_mes" class="form-group" style="display: none;">
      <label for="id_mes">MÃªs:</label>
      {{ period_form.mes }}
    </div>
    <div id="div_id_semana" class="form-group">
      <label for="id_semana">Semana:</label>
      {{ period_form.semana }}
    </div>
  </form>
</div>

<table class="main-table ranking-table">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th style="width:60%"></th>
      <th>Pontos</th>
      <th style="width:30%"></th>
    </tr>
  </thead>
  <tbody>
    {% for entry in ranking_entries %}
      <tr
        class="clickable-row"
        name="clickable-row{{ entry.user.id }}"
        onclick="expandDetailRow('{{ entry.user.id }}')"
      >
        <td>
          {% if forloop.counter == 1 %}
          ðŸ¥‡
          {% elif forloop.counter == 2 %}
          ðŸ¥ˆ
          {% elif forloop.counter == 3 %}
          ðŸ¥‰
          {% elif forloop.last %}
          ðŸ”¦
          {% endif %}
        </td>
        <td>{{ forloop.counter }}Âº</td>
        <td style="text-align:left">{{ entry }}</td>
        <td>{{ entry.score }}</td>
        <td class="expand-icon">Palpites ðŸ”½</td>
      </tr>

      <tr
        class="detail-row"
        name="detail-row{{ entry.user.id }}"
        style="display: none"
      >
        <td colspan="5" class="detail-table-container">
          <table class="detail-table">
            <thead>
              <tr>
                <th style="width:50%">Partida</th>
                <th style="width:15%">Resultado</th>
                <th style="width:15%">Palpite</th>
                <th style="width:15%">PontuaÃ§Ã£o</th>
                <th style="width:5%"></th>
              </tr>
            </thead>
            <tbody>
              {% comment %} {% for match_and_guess in entry.matches_and_guesses %}
                <tr class="detail-table-row">
                  <td>
                      <p class="match-time">{{ match_and_guess.match.date_time|date:"l d/m H:i" }}</p>
                      <p>{{ match_and_guess.match.home_team }}</p>
                      <p>x</p>
                      <p>{{ match_and_guess.match.away_team }}</p>
                  </td>
                  <td>{{ match_and_guess.match.result_str|default:"-" }}</td>
                  {% if match_and_guess.guess %}
                    <td>{{ match_and_guess.guess.result_str }}</td>
                    {% if match_and_guess.match.result_str %}
                      <td>{{ match_and_guess.guess.get_score }}</td>
                    {% else %}
                      <td>-</td>
                    {% endif %}
                  {% else %}
                    <td>-</td>
                    <td>-</td>
                  {% endif %}
                  <td>
                    {% if match_and_guess.match.double_score %}
                    ðŸ”¥
                    {% endif %}
                  </td>
                </tr>
              {% endfor %} {% endcomment %}
            </tbody>
          </table>
        </td>
      </tr>

    {% empty %}
      <tr>
          <td colspan="5" style="text-align: center; padding: 20px;">
              NÃ£o hÃ¡ dados de classificaÃ§Ã£o para o perÃ­odo selecionado.
          </td>
      </tr>
    {% endfor %}
</tbody>
</table>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const form = document.getElementById('ranking-form');
    const periodoSelect = document.getElementById('id_periodo');
    const anoDiv = document.getElementById('div_id_ano');
    const mesDiv = document.getElementById('div_id_mes');
    const semanaDiv = document.getElementById('div_id_semana');
    const anoSelect = document.getElementById('id_ano');
    const mesSelect = document.getElementById('id_mes');
    const semanaSelect = document.getElementById('id_semana');

    function toggleFields() {
      const selectedPeriod = periodoSelect.value;
      anoDiv.style.display = 'none';
      mesDiv.style.display = 'none';
      semanaDiv.style.display = 'none';

      if (selectedPeriod === 'anual') {
        anoDiv.style.display = 'block';
      } else if (selectedPeriod === 'mensal') {
        mesDiv.style.display = 'block';
      } else if (selectedPeriod === 'semanal') {
        semanaDiv.style.display = 'block';
      }
    }

    function submitForm() {
      form.submit();
    }

    periodoSelect.addEventListener('change', toggleFields);
    anoSelect.addEventListener('change', submitForm);
    mesSelect.addEventListener('change', submitForm);
    semanaSelect.addEventListener('change', submitForm);

    toggleFields();
  });
</script>

{% endblock content %}
